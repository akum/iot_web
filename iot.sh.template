#!/bin/bash
# Copy this script to /usr/local/bin/ and
# Make this script a cron job, run:
# crontab -e
# Add the line: */5 * * * * /usr/local/bin/iot.sh

email="myemail"
pass="mypass"
secret="mysecret"
zipcode="myzip"
neviID="myID"

token=$(curl -s "https://neviweb.com/api/login" -H "Content-Type: application/x-www-form-urlencoded" --data "email=$email&password=$pass"| jq -r .session)
temp1=$(curl -s "https://neviweb.com/api/device/3381/data?force=2" -H "Session-Id: $token"| jq -r .temperature)
temp2=$(curl -s "https://neviweb.com/api/device/3380/data?force=2" -H "Session-Id: $token"| jq -r .temperature)
temp3=$(curl -s "https://neviweb.com/api/device/3379/data?force=2" -H "Session-Id: $token"| jq -r .temperature)
temp4=$(curl -s "https://neviweb.com/api/device/3378/data?force=2" -H "Session-Id: $token"| jq -r .temperature)

heat1=$(curl -s "https://neviweb.com/api/device/3381/data?force=2" -H "Session-Id: $token"| jq -r .heatLevel)
heat2=$(curl -s "https://neviweb.com/api/device/3380/data?force=2" -H "Session-Id: $token"| jq -r .heatLevel)
heat3=$(curl -s "https://neviweb.com/api/device/3379/data?force=2" -H "Session-Id: $token"| jq -r .heatLevel)
heat4=$(curl -s "https://neviweb.com/api/device/3378/data?force=2" -H "Session-Id: $token"| jq -r .heatLevel)

exter=$(curl -s "https://neviweb.com/api/weather/$zipcode?_=$neviID" -H "Session-Id: $token"| jq -r .temperature)

curl -s "http://localhost:8080/iot/add.php" --data "temp1=$temp1&temp2=$temp2&temp3=$temp3&temp4=$temp4&h1=$heat1&h2=$heat2&h3=$heat3&h4=$heat4&ex=$exter&key=$secret"
